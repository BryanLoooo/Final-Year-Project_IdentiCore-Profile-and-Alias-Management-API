<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>IdentiCore â€¢ Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles/styles.css" />
</head>
<script>
  function toggleTheme() {
    const isDark = document.getElementById('theme-toggle').checked;
    document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  }

  // On load: restore theme
  (function() {
    const saved = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', saved);
    if (saved === 'dark') {
      document.getElementById('theme-toggle').checked = true;
    }
  })();
</script>
<body onload="requireAuth(); initSettings()">
  <header class="nav">
    <div class="container nav__row">
      <div class="brand" onclick="location.href='index.html'" style="cursor:pointer">
        <img src="assets/identicore.jpg" alt="identicore" style="width:130px; height:50px; border-radius: 10px;" />
      </div>
      <nav class="nav__links">
        <a href="index.html">Dashboard</a>
        <a href="view-aliases.html">All Aliases</a>
        <a href="create-alias.html">Create Alias</a>
        <a href="settings.html">Settings</a>
        <button class="btn logoutbtn" onclick="logout()">Logout</button>
      </nav>
    </div>
  </header>

  <main class="main">
    <div class="container" style="max-width:720px">
      
            <!-- Profile Settings -->
<section class="panel">
  <h1 class="h1">Profile management</h1>
  <p class="p">Update your user details.</p>
  <div class="form">
    <label>Username</label>
    <input id="user-username" class="input" type="text" placeholder="Username" />

    <label>Email</label>
    <input id="user-email" class="input" type="email" placeholder="Email" />

    <label>Age</label>
    <input id="user-age" class="input" type="number" placeholder="Age" />

    <button class="btn btn--primary" onclick="updateProfile()">Save Profile</button>
  </div>
</section>
<!-- Theme Settings -->
      <section class="panel">
        <h1 class="h1">Theme Mode</h1>
        <p class="p">Toggle between light and dark themes for better readability and comfort.</p>
        <div class="form">
          <label class="row" style="justify-content: space-between">
            <span>Enable Dark Mode</span>
            <input id="theme-toggle" type="checkbox" onchange="toggleTheme()" />
          </label>
        </div>
      </section>
      <!-- Reminder Settings -->
      <section class="panel">
        <h1 class="h1">Reminders customization</h1>
        <p class="p">Control if and how often IdentiCore nudges you to add or review aliases.</p>
        <div class="form">
          <label class="row" style="justify-content:space-between">
            <span>Enable reminders</span>
            <input id="rem-enabled" type="checkbox" />
          </label>

          <label>Frequency</label>
          <select id="rem-frequency" class="input">
            <option value="none">None</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>

          <button class="btn btn--primary" onclick="saveReminder()">Save Reminder Settings</button>
        </div>
      </section>

      <!-- Danger Zone -->
      <section class="panel">
        <h1 class="h1">Danger Zone</h1>
        <p class="p">Deleting your account will permanently remove all data, aliases, and settings. This action cannot be undone.</p>
        <button class="btn btn--ghost" style="background-color:#f87171; color:white" onclick="confirmDelete()">Delete My Account</button>
      </section>
    </div>
  </main>

<!-- footer section has footer elements as well as developer social icons -->
<footer class="footer">
  <div class="container row" style="justify-content:space-between; align-items: flex-start; flex-wrap: wrap; gap: 20px">
    <div style="display: flex; flex-direction: column; gap: 8px;">
      <a href="about.html">About Us</a>
      <a href="faq.html">FAQ</a>
      <a href="terms.html">Terms & Conditions</a>
    </div>
    <div class="row" style="gap: 14px;">
      <a href="https://www.linkedin.com/in/bryan-loo-2a7973200/" target="_blank" aria-label="linkedin">
        <img src="assets/linkedin.jpg" alt="linkedin" style="width:24px; height:24px; border-radius: 10px;" />
      </a>
      <a href="https://github.com/BryanLoooo" target="_blank" aria-label="github">
        <img src="assets/github.jpg" alt="github" style="width:24px; height:24px; border-radius: 10px;" />
      </a>
    </div>
  </div>
</footer>
  <div class="toast" aria-live="polite"></div>
  <script src="app.js"></script>

  <script>
     let me = null;

  async function initSettings() {
    me = await apiFetch('/api/user/me', { method: 'GET' });
    if (!me) return;

    // Reminder settings
    document.getElementById('rem-enabled').checked = !!me.reminder?.enabled;
    document.getElementById('rem-frequency').value = me.reminder?.frequency || 'none';

    // Profile details
    document.getElementById('user-username').value = me.username || '';
    document.getElementById('user-email').value = me.email || '';
    document.getElementById('user-age').value = me.age || '';
    document.getElementById('user-address1').value = me.addressLine1 || '';
    document.getElementById('user-address2').value = me.addressLine2 || '';
  }

    async function saveReminder() {
      const enabled = document.getElementById('rem-enabled').checked;
      const frequency = document.getElementById('rem-frequency').value;
      const res = await apiFetch('/api/user/settings/reminder', {
        method: 'PUT',
        body: JSON.stringify({ enabled, frequency })
      });
      toast(res?.message || 'Reminder settings saved.');
    }

     async function updateProfile() {
        const updates = {
        username: document.getElementById('user-username').value.trim(),
        email: document.getElementById('user-email').value.trim(),
        age: document.getElementById('user-age').value.trim()
      };

      const res = await apiFetch('/api/user/settings/profile', {
        method: 'PUT',
        body: JSON.stringify(updates)
      });

          toast(res?.message || 'Profile updated.');
        }

    async function confirmDelete() {
      if (!confirm("Are you sure you want to permanently delete your account? This action cannot be undone.")) return;

      const res = await apiFetch('/api/user/me', { method: 'DELETE' });
      if (res?.message) {
        toast('Account deleted');
        setTimeout(() => {
          location.href = 'login.html';
        }, 800);
      } else {
        toast(res?.error || 'Failed to delete account');
      }
    }
  </script>
</body>
</html>
